#include <iostream>
#include <vector>
using namespace std;

enum Color { WHITE, BLACK };

// ================= PIECE =================
class Piece {
protected:
    Color color;
public:
    Piece(Color c) : color(c) {}
    virtual ~Piece() {}
    Color getColor() const { return color; }

    virtual char symbol() const = 0;
    virtual bool isValidMove(int sx, int sy, int dx, int dy) const = 0;
};

// ================= PAWN =================
class Pawn : public Piece {
public:
    Pawn(Color c) : Piece(c) {}

    char symbol() const override {
        return color == WHITE ? 'P' : 'p';
    }

    bool isValidMove(int sx, int sy, int dx, int dy) const override {
        int direction = (color == WHITE) ? -1 : 1;
        return (sx == dx && dy - sy == direction);
    }
};

// ================= ROOK =================
class Rook : public Piece {
public:
    Rook(Color c) : Piece(c) {}

    char symbol() const override {
        return color == WHITE ? 'R' : 'r';
    }

    bool isValidMove(int sx, int sy, int dx, int dy) const override {
        return sx == dx || sy == dy;
    }
};

// ================= KNIGHT =================
class Knight : public Piece {
public:
    Knight(Color c) : Piece(c) {}

    char symbol() const override {
        return color == WHITE ? 'N' : 'n';
    }

    bool isValidMove(int sx, int sy, int dx, int dy) const override {
        int dxAbs = abs(dx - sx);
        int dyAbs = abs(dy - sy);
        return (dxAbs == 2 && dyAbs == 1) || (dxAbs == 1 && dyAbs == 2);
    }
};

// ================= BISHOP =================
class Bishop : public Piece {
public:
    Bishop(Color c) : Piece(c) {}

    char symbol() const override {
        return color == WHITE ? 'B' : 'b';
    }

    bool isValidMove(int sx, int sy, int dx, int dy) const override {
        return abs(dx - sx) == abs(dy - sy);
    }
};

// ================= QUEEN =================
class Queen : public Piece {
public:
    Queen(Color c) : Piece(c) {}

    char symbol() const override {
        return color == WHITE ? 'Q' : 'q';
    }

    bool isValidMove(int sx, int sy, int dx, int dy) const override {
        return sx == dx || sy == dy || abs(dx - sx) == abs(dy - sy);
    }
};

// ================= KING =================
class King : public Piece {
public:
    King(Color c) : Piece(c) {}

    char symbol() const override {
        return color == WHITE ? 'K' : 'k';
    }

    bool isValidMove(int sx, int sy, int dx, int dy) const override {
        return abs(dx - sx) <= 1 && abs(dy - sy) <= 1;
    }
};

// ================= BOARD =================
class Board {
private:
    Piece*** board;

public:
    Board() {
        board = new Piece**[8];
        for (int i = 0; i < 8; i++) {
            board[i] = new Piece*[8]{ nullptr };
        }
        setup();
    }

    ~Board() {
        for (int i = 0; i < 8; i++) {
            for (int j = 0; j < 8; j++)
                delete board[i][j];
            delete[] board[i];
        }
        delete[] board;
    }

    void setup() {
        for (int i = 0; i < 8; i++) {
            board[1][i] = new Pawn(BLACK);
            board[6][i] = new Pawn(WHITE);
        }

        board[0][0] = board[0][7] = new Rook(BLACK);
        board[7][0] = board[7][7] = new Rook(WHITE);

        board[0][1] = board[0][6] = new Knight(BLACK);
        board[7][1] = board[7][6] = new Knight(WHITE);

        board[0][2] = board[0][5] = new Bishop(BLACK);
        board[7][2] = board[7][5] = new Bishop(WHITE);

        board[0][3] = new Queen(BLACK);
        board[7][3] = new Queen(WHITE);

        board[0][4] = new King(BLACK);
        board[7][4] = new King(WHITE);
    }

    Piece* get(int x, int y) {
        return board[x][y];
    }

    bool move(int sx, int sy, int dx, int dy, Color playerColor) {
        Piece* p = board[sx][sy];
        if (!p || p->getColor() != playerColor) return false;
        if (!p->isValidMove(sx, sy, dx, dy)) return false;

        delete board[dx][dy];
        board[dx][dy] = p;
        board[sx][sy] = nullptr;
        return true;
    }

    void print() {
        cout << "\n";
        for (int i = 0; i < 8; i++) {
            for (int j = 0; j < 8; j++) {
                cout << (board[i][j] ? board[i][j]->symbol() : '.') << " ";
            }
            cout << endl;
        }
    }
};

// ================= PLAYER =================
class Player {
public:
    Color color;
    Player(Color c) : color(c) {}
};

// ================= GAME =================
class Game {
private:
    Board board;
    Player p1{WHITE}, p2{BLACK};
    Player* current;

public:
    Game() : current(&p1) {}

    void play() {
        int sx, sy, dx, dy;
        while (true) {
            board.print();
            cout << (current->color == WHITE ? "WHITE" : "BLACK")
                 << " move (sx sy dx dy): ";
            cin >> sx >> sy >> dx >> dy;

            if (board.move(sx, sy, dx, dy, current->color))
                current = (current == &p1) ? &p2 : &p1;
            else
                cout << "Invalid move!\n";
        }
    }
};

// ================= MAIN =================
int main() {
    Game game;
    game.play();
    return 0;
